  WITH BI AS
(
  SELECT BADGE_C.CARDNO, BADGE_V.BADGE_EMPLOYEE_NO
  FROM BADGE_V 
  INNER JOIN BADGE_C ON BADGE_C.ID = BADGE_V.ID
),
empScans as 
(SELECT EVNT_DAT, LOCATION, cast(CARDNO as varchar(5)) AS CARDNO, FNAME, LNAME, PANEL_DESCRP, CARDSTATUS.DESCRP AS statDescrp
FROM EV_LOG
INNER JOIN CARDSTATUS ON CARDSTATUS.STATUS = EV_LOG.STAT_COD
WHERE (EVNT_DAT IS NOT NULL)
AND (LNAME IS NOT NULL)
AND (FNAME IS NOT NULL)
GROUP BY CARDNO, LOCATION, FNAME, LNAME, EVNT_DAT, PANEL_DESCRP, CARDSTATUS.DESCRP
)
SELECT * FROM empScans
INNER JOIN BI ON BI.CARDNO = empScans.CARDNO
WHERE (EVNT_DAT >  @StartDate)	
AND (EVNT_DAT < @EndDate) 
AND (BADGE_EMPLOYEE_NO = @EmpNum)
AND (statDescrp='Active' OR statDescrp='Disabled')
ORDER BY evnt_dat desc
